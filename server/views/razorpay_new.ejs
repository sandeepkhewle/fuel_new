<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Razorpay Payment</title>
</head>

<body>
  <h1>Razorpay Payment Gateway Integration - v2</h1>

  <!-- Display amount as a simple text -->
  <p>
    Amount: <%= restdata.amount %> INR
  </p>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    // Inject restdata object from server-side into the JavaScript
    var d = <% - JSON.stringify(restdata) %>;
    // console.log("d---------------------------", d);


    var restdata = <%= JSON.stringify(restdata) %>;
    // console.log("Inject---------------------------", restdata);


    async function payNow(d) {
      console.log("restdata------------------------------------", restdata.replace(/&#34;/g, '"'));
      restdata = JSON.parse(restdata.replace(/&#34;/g, '"'));


      restdata
      var options = {
        "key": restdata.razorpayKeyId, // Razorpay Key ID from backend
        "amount": restdata.amount, // Amount in currency subunits
        "currency": restdata.currency,
        "name": restdata.name, // Merchant name
        "description": restdata.description, // Description
        "order_id": restdata.id, // Razorpay order ID
        "handler": function (response) {
          console.log(response);
          alert("Payment Succeeded");
        },
        "prefill": {
          "name": restdata.userName, // Pre-fill user's name
          "email": restdata.userEmail, // Pre-fill user's email
          "contact": restdata.userContact // Pre-fill user's contact number
        },
        "notes": {},
        "theme": {
          "color": "#2300a3" // Customize theme color
        }
      };

      // Create new Razorpay object
      var razorpayObject = new Razorpay(options);

      // Attach error handling for payment failure
      razorpayObject.on('payment.failed', function (response) {
        console.log(response);
        alert("Payment Failed");
      });

      // Open Razorpay payment window
      razorpayObject.open();
    }

    // Automatically run the payNow function with the restdata object
    window.onload = function () {
      setTimeout(() => {
        console.log("Auto-triggering payNow()");
        payNow(restdata); // Pass the restdata object to payNow()
      }, 100); // 1-second delay for smoother loading
    };
  </script>
</body>

</html>